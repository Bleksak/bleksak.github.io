



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Generating a spiral-like data structure - Bleksak's coding adventures</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#generating-a-spiral-like-data-structure" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Bleksak's coding adventures" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Bleksak's coding adventures
            </span>
            <span class="md-header-nav__topic">
              
                Generating a spiral-like data structure
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Bleksak's coding adventures" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Bleksak's coding adventures
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Posts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Posts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Generating a spiral-like data structure
      </label>
    
    <a href="./" title="Generating a spiral-like data structure" class="md-nav__link md-nav__link--active">
      Generating a spiral-like data structure
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementation-in-c" title="Implementation in C" class="md-nav__link">
    Implementation in C
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementation-in-c" title="Implementation in C" class="md-nav__link">
    Implementation in C
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="generating-a-spiral-like-data-structure">Generating a spiral-like data structure</h1>
<p>Someday you may need to generate a data structure, which we could visualize like this: 
<img alt="Spiral" src="/img/spiral.png" /></p>
<p>I found this problem when trying to store a minecraft-like map in my OpenGL project called <a href="https://github.com/Bleksak/automatic-fortnight">Automatic-Fortnight</a></p>
<p>The way I generated this data structure is by realizing, how the data structure works. Let's name the directions in which we move</p>
<p><strong> R =&gt; Right<br />
L =&gt; left<br />
U =&gt; Up<br />
D =&gt; Down</strong></p>
<p>Now, if we look at the spiral, we can see that we go RU, LLDD, RRRUUU, LLLLDDDD etc. What we can deduce from this is, that even number means that we go left/down and odd number means we go right/up. We also see that the numbers always increase by 1, this means, that this spiral is "only" an arithmetic sequence starting at 0 with difference of 1.</p>
<p>So we create a sum of this arithmetic sequence, which looks like this:</p>
<p><code>2n(1 + n)/2 + offset = i</code><br />
Where n is the index of the element in the arithmetic sequence and i is the spiral index.</p>
<p>Why the 2n you may ask, and that's because R/U and L/D are there both twice, so we need to multiply by 2. </p>
<p>Another question might be: What is offset ? Where does it come from?<br />
Because the arithmetic sequence will end up in the top right corner or the bottom left corner (depending on the odd/even number situation) we need to add some number to our result to get the actual coordinate, to achieve this, we say that offset = 0, solve for this equation and then calculate the offset.  </p>
<p>So we simplify to <code>n(1+n) = i</code></p>
<p>We get a quadratic equation which we know will have 2 solutions, but one of them will be always negative, which doesn't make sense for arithmetic sequences. So the actual solution is</p>
<p><code>n = (-1 + √(1 + 4i))/2</code></p>
<p>Now that we have n, we need the sum of the first n elements in the sequence, but we already know n so it's very simple:</p>
<p><code>sum = n(1+n)</code></p>
<p>Now we can actually calculate the offset that I talked about before:</p>
<p><code>offset = i - sum</code></p>
<p>But if you pay more attention, we actually need 2 arithmetic sequences, one for the Up/Right Directions and second for the Down/Left directions, both will have different N's. Let's call them Rn and Ln.</p>
<p><code>Rn = n%2 == 0 ? n : n - 1</code><br />
<code>Ln = n%2 == 0 ? n - 1 : n</code></p>
<p>Now we take their sums and subtract them, the result will be our initial x and y coordinate:  </p>
<p><code>x, y = ((1 + Rn) * Rn) / 2 - (Ln * Ln)/2</code></p>
<p>For the final part, we need to add the offset which we calculated earlier, but how? It depends on whether the offset is longer than the line where we stand. Because, let's say we are at [3, 3] and the offset is 7, the correct coordinate would then be [-3, 2] but how do we get there? Well we calculate the xoffset from this equation:</p>
<p><code>xoffset = (offset &gt; n+1) ? n + 1 : offset</code></p>
<p>Then we can just subtract xoffset from offset to get yoffset:</p>
<p><code>yoffset = offset - xoffset</code></p>
<p>And now add this, multiplied by the sign depending on wheteher we are on even/odd number to the x and y coordinates.</p>
<p><code>x += (n%2 == 0) ? xoffset : -xoffset</code><br />
<code>y += (n%2 == 0) ? yoffset : -yoffset</code></p>
<h2 id="implementation-in-c">Implementation in C</h2>
<pre><code class="C">static struct Vector2D getSpiralCoords(unsigned long long i)
{
    unsigned long long n = ((-1.0f + sqrtf(1.0f + (4.0f * (float)i)))/2.0f);

    unsigned long long sum = (n * (1 + n));
    unsigned long long offset = i - sum;

    unsigned long long Rn = (n&amp;1) ? n : n - 1;
    unsigned long long Ln = (n&amp;1) ? n - 1 : n;

    unsigned long long Rsum = ((1 + Rn) * Rn) &gt;&gt; 1;
    unsigned long long Lsum = (Ln * Ln) &gt;&gt; 1;

    long long sign = ((n&amp;1) ? 1 : -1);

    long long x = Rsum - Lsum, y = x;

    unsigned long long xoffset = (offset &gt; n+1) ? n+1 : offset;
    unsigned long long yoffset = offset - xoffset;

    x += -sign * xoffset;
    y += -sign * yoffset;

    return (struct Vector2D){x, y};
}
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>